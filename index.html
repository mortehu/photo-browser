<!DOCTYPE html>
<html>
<head>
  <title>Google Photos Album Viewer</title>
  <style>
    img, video {
      max-width: 100%;
      height: auto;
    }
  </style>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client"></script>
  <script>
    var accessToken;

    const client = google.accounts.oauth2.initTokenClient({
      client_id: '857477745476-5e96rcldibfbaj5ri6u84t6l136at0bo.apps.googleusercontent.com',
      scope: 'https://www.googleapis.com/auth/photoslibrary.readonly',
      ux_mode: 'popup',
      callback: (response) => { accessToken = response.access_token; }
    });

    function start() {
      return gapi.load('client', loadClient);
    }

    function loadClient() {
      gapi.client.setToken({access_token: accessToken});
      return gapi.client.load("https://content.googleapis.com/discovery/v1/apis/photoslibrary/v1/rest")
        .then(
          displayAlbums,
          function(err) { console.error("Error loading GAPI client for API", err); }
        );
    }

    function displayAlbums() {
      return gapi.client.photoslibrary.albums.list()
        .then(
          function(response) {
            const albums = response.result.albums;
            const select = document.getElementById('album-selector');
            select.innerHTML = '';

            albums.forEach(album => {
              const option = document.createElement('option');
              option.value = album.id;
              option.textContent = album.productUrl;
              select.appendChild(option);
            });
          },
          function(err) { console.error("Error getting albums", err); }
        );
    }

    function displayMediaItems(albumId) {
      return gapi.client.photoslibrary.mediaItems.search({albumId: albumId})
        .then(
          function(response) {
            const mediaItems = response.result.mediaItems;
            const container = document.getElementById('media-container');
            container.innerHTML = '';

            mediaItems.forEach(item => {
              if (item.mimeType.startsWith("image/")) {
                const img = document.createElement('img');
                img.src = item.baseUrl;
                container.appendChild(img);
              } else if (item.mimeType.startsWith("video/")) {
                const video = document.createElement('video');
                video.controls = true;
                video.src = item.baseUrl;
                container.appendChild(video);
              }
            });
          },
          function(err) { console.error("Error getting media items", err); }
        );
    }

    function onAlbumChange() {
      const albumId = document.getElementById('album-selector').value;
      displayMediaItems(albumId);
    }
  </script>
</head>
<body>
  <button onclick='client.requestAccessToken()'>Log in</button>
  <button onclick='start()'>Start</button>
  <h2>Select an Album:</h2>
  <select id="album-selector" onchange="onAlbumChange()"></select>
  <div id="media-container"></div>
</body>
</html>
